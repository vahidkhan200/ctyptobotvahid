# strategies.py

def analyze_symbol(symbol_data):
    """
    تحلیل ساده‌ی داده‌های قیمت برای تولید سیگنال ترید.
    ورودی: symbol_data شامل 'symbol' و 'klines' (لیست کندل‌ها)
    خروجی: دیکشنری شامل symbol و سیگنال ('buy', 'sell', 'hold')
    """

    try:
        klines = symbol_data.get('klines', [])
        symbol = symbol_data.get('symbol', 'UNKNOWN')

        if len(klines) < 2:
            return {'symbol': symbol, 'signal': 'hold'}

        # فرض: قیمت بسته شدن کندل آخر و قبل از آن
        last_close = float(klines[-1][4])
        prev_close = float(klines[-2][4])

        if last_close > prev_close * 1.01:
            signal = 'buy'
        elif last_close < prev_close * 0.99:
            signal = 'sell'
        else:
            signal = 'hold'

        return {
            'symbol': symbol,
            'signal': signal
        }

    except Exception as e:
        return {
            'symbol': symbol_data.get('symbol', 'UNKNOWN'),
            'signal': 'error',
            'error': str(e)
        }
